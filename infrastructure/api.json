Description: ForwardsFlow AppSync API and Cognito
Resources:
  ForwardsFlowUserPoolDE2BB0ED:
    Type: AWS::Cognito::UserPool
    Properties:
      AccountRecoverySetting:
        RecoveryMechanisms:
          - Name: verified_email
            Priority: 1
      AdminCreateUserConfig:
        AllowAdminCreateUserOnly: true
      AutoVerifiedAttributes:
        - email
      EmailVerificationMessage: The verification code to your new account is {####}
      EmailVerificationSubject: Verify your new account
      Policies:
        PasswordPolicy:
          MinimumLength: 8
          RequireLowercase: true
          RequireNumbers: true
          RequireSymbols: false
          RequireUppercase: true
      Schema:
        - Mutable: true
          Name: email
          Required: true
        - Mutable: true
          Name: name
          Required: true
        - AttributeDataType: String
          Mutable: true
          Name: orgId
        - AttributeDataType: String
          Mutable: true
          Name: role
        - AttributeDataType: String
          Mutable: true
          Name: orgType
      SmsVerificationMessage: The verification code to your new account is {####}
      UserPoolName: ForwardsFlow-Users
      UserPoolTags:
        Environment: development
        Project: ForwardsFlow
      UsernameAttributes:
        - email
      VerificationMessageTemplate:
        DefaultEmailOption: CONFIRM_WITH_CODE
        EmailMessage: The verification code to your new account is {####}
        EmailSubject: Verify your new account
        SmsMessage: The verification code to your new account is {####}
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowUserPool/Resource
  ForwardsFlowUserPoolForwardsFlowWebClient8B6306A6:
    Type: AWS::Cognito::UserPoolClient
    Properties:
      AllowedOAuthFlows:
        - code
      AllowedOAuthFlowsUserPoolClient: true
      AllowedOAuthScopes:
        - email
        - openid
        - profile
      CallbackURLs:
        - https://example.com
      ClientName: ForwardsFlow-WebApp
      ExplicitAuthFlows:
        - ALLOW_USER_PASSWORD_AUTH
        - ALLOW_USER_SRP_AUTH
        - ALLOW_REFRESH_TOKEN_AUTH
      SupportedIdentityProviders:
        - COGNITO
      UserPoolId:
        Ref: ForwardsFlowUserPoolDE2BB0ED
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowUserPool/ForwardsFlowWebClient/Resource
  ForwardsFlowApiApiLogsRole6DF13DE9:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: appsync.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSAppSyncPushToCloudWatchLogs
      Tags:
        - Key: Environment
          Value: development
        - Key: Project
          Value: ForwardsFlow
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ApiLogsRole/Resource
  ForwardsFlowApi1E228389:
    Type: AWS::AppSync::GraphQLApi
    Properties:
      AdditionalAuthenticationProviders:
        - AuthenticationType: API_KEY
        - AuthenticationType: AWS_IAM
      AuthenticationType: AMAZON_COGNITO_USER_POOLS
      LogConfig:
        CloudWatchLogsRoleArn:
          Fn::GetAtt:
            - ForwardsFlowApiApiLogsRole6DF13DE9
            - Arn
        FieldLogLevel: ERROR
      Name: ForwardsFlow-API
      Tags:
        - Key: Environment
          Value: development
        - Key: Project
          Value: ForwardsFlow
      UserPoolConfig:
        AwsRegion: eu-west-1
        DefaultAction: ALLOW
        UserPoolId:
          Ref: ForwardsFlowUserPoolDE2BB0ED
      XrayEnabled: true
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/Resource
  ForwardsFlowApiSchemaBCD6DAB4:
    Type: AWS::AppSync::GraphQLSchema
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      Definition: |
        # ForwardsFlow GraphQL Schema
        # Impact Investment Platform - Real-time API

        # ============================================
        # ENUMS
        # ============================================

        enum OrganizationType {
          BANK
          INVESTOR
        }

        enum OrganizationStatus {
          PENDING
          ACTIVE
          SUSPENDED
          INACTIVE
        }

        enum UserRole {
          # Platform Level
          FORWARDSFLOW_ADMIN
          
          # Bank Tenant Roles
          BANK_ADMIN
          BANK_LENDER
          BANK_CALLER
          BANK_COMPLIANCE
          BANK_RISK
          
          # Investor Tenant Roles
          INVESTOR_ADMIN
          INVESTOR_ANALYST
        }

        enum UserStatus {
          PENDING
          ACTIVE
          SUSPENDED
          INACTIVE
        }

        enum CapitalCallStatus {
          DRAFT
          PUBLISHED
          ACCEPTED
          KYC_REVIEW
          PROCESSING
          COMPLETED
          EXPIRED
          CANCELLED
        }

        enum InvestmentStatus {
          PENDING
          KYC_SUBMITTED
          KYC_APPROVED
          FUNDS_PENDING
          ACTIVE
          MATURED
          SETTLED
          CANCELLED
        }

        enum MobileLoanStatus {
          PENDING
          APPROVED
          DISBURSED
          CURRENT
          OVERDUE
          DEFAULTED
          SETTLED
          WRITTEN_OFF
        }

        enum PaymentType {
          MPESA_DISBURSEMENT
          MPESA_REPAYMENT
          SWIFT_DEPOSIT
          SWIFT_SETTLEMENT
          INTERNAL_TRANSFER
        }

        enum PaymentStatus {
          PENDING
          PROCESSING
          COMPLETED
          FAILED
          REVERSED
        }

        enum NotificationType {
          INFO
          SUCCESS
          WARNING
          ERROR
          OPPORTUNITY
          SYSTEM
        }

        enum AuditAction {
          CREATE
          UPDATE
          DELETE
          LOGIN
          LOGOUT
          APPROVE
          REJECT
          SUSPEND
          ACTIVATE
        }

        # ============================================
        # TYPES
        # ============================================

        type Organization {
          orgId: ID!
          orgType: OrganizationType!
          name: String!
          email: String!
          country: String!
          status: OrganizationStatus!
          
          # Type-specific fields
          institutionType: String
          moodysRating: String
          website: String
          address: String
          phone: String
          logo: String
          
          # Bank-specific
          swiftCode: String
          centralBankLicense: String
          
          # Investor-specific
          aum: Float
          investmentFocus: [String]
          
          # Metadata
          createdAt: AWSDateTime!
          updatedAt: AWSDateTime!
          createdBy: ID
          
          # Computed/Aggregated
          totalCapital: Float
          totalInvested: Float
          activeLoans: Int
          activeInvestments: Int
          adminCount: Int
          userCount: Int
          
          # Related
          users: [User]
        }

        type User {
          userId: ID!
          email: String!
          name: String!
          role: UserRole!
          status: UserStatus!
          
          # Organization link
          orgId: ID
          organization: Organization
          
          # Profile
          jobRole: String
          phone: String
          avatar: String
          
          # Security
          lastLogin: AWSDateTime
          mfaEnabled: Boolean
          
          # Metadata
          createdAt: AWSDateTime!
          updatedAt: AWSDateTime!
          createdBy: ID
        }

        type CapitalCall {
          callId: ID!
          txnRef: String!
          
          # Issuing bank
          bankOrgId: ID!
          bank: Organization
          
          # Terms
          amount: Float!
          currency: String!
          targetCurrency: String!
          maturityMonths: Int!
          interestRate: Float!
          
          # FX/Hedging
          fxSpread: Float
          hedgingFee: Float
          currentFxRate: Float
          hedgedFxRate: Float
          
          # Status & Lifecycle
          status: CapitalCallStatus!
          createdAt: AWSDateTime!
          updatedAt: AWSDateTime!
          publishedAt: AWSDateTime
          expiresAt: AWSDateTime
          
          # Acceptance
          acceptedBy: ID
          acceptedByOrg: Organization
          acceptedAt: AWSDateTime
          
          # Completion
          completedAt: AWSDateTime
          
          # Related
          investments: [Investment]
          
          # Computed
          subscribed: Float
          subscribedPct: Float
          projectedYield: Float
          
          # Metadata
          createdBy: ID
          intendedUse: String
          notes: String
        }

        type Investment {
          investmentId: ID!
          txnRef: String!
          
          # Capital Call link
          callId: ID!
          capitalCall: CapitalCall
          
          # Investor
          investorOrgId: ID!
          investor: Organization
          
          # Investment details
          amount: Float!
          currency: String!
          interestRate: Float!
          maturityDate: AWSDateTime!
          
          # Status
          status: InvestmentStatus!
          createdAt: AWSDateTime!
          updatedAt: AWSDateTime!
          
          # KYC
          kycDocuments: AWSJSON
          kycSubmittedAt: AWSDateTime
          kycApprovedAt: AWSDateTime
          kycApprovedBy: ID
          
          # Bank Details
          bankDetails: AWSJSON
          
          # Settlement
          settledAt: AWSDateTime
          settledAmount: Float
          
          # Computed
          expectedReturn: Float
          accruedInterest: Float
          daysToMaturity: Int
          
          # Metadata
          createdBy: ID
        }

        type MobileLoan {
          loanId: ID!
          loanRef: String!
          
          # Bank
          bankOrgId: ID!
          bank: Organization
          
          # Borrower
          borrowerPhone: String!
          borrowerName: String
          borrowerIdNumber: String
          
          # Loan Terms
          amount: Float!
          currency: String!
          interestRate: Float!
          term: Int!
          
          # Status
          status: MobileLoanStatus!
          createdAt: AWSDateTime!
          updatedAt: AWSDateTime!
          
          # Lifecycle
          approvedAt: AWSDateTime
          approvedBy: ID
          disbursedAt: AWSDateTime
          dueDate: AWSDateTime
          settledAt: AWSDateTime
          
          # Repayment
          amountPaid: Float
          amountOutstanding: Float
          daysOverdue: Int
          
          # Credit
          creditScore: Int
          creditLimit: Float
          
          # WhatsApp
          whatsappSessionId: String
          lastWhatsappMessage: AWSDateTime
          
          # Related
          payments: [Payment]
        }

        type Payment {
          paymentId: ID!
          paymentRef: String!
          type: PaymentType!
          status: PaymentStatus!
          
          # Links
          loanId: ID
          investmentId: ID
          orgId: ID
          
          # Amount
          amount: Float!
          currency: String!
          
          # MPESA specific
          mpesaRef: String
          mpesaPhone: String
          
          # SWIFT specific
          swiftRef: String
          swiftBank: String
          swiftAccount: String
          
          # Metadata
          createdAt: AWSDateTime!
          updatedAt: AWSDateTime!
          completedAt: AWSDateTime
          failureReason: String
        }

        type Notification {
          notificationId: ID!
          userId: ID!
          orgId: ID
          
          type: NotificationType!
          title: String!
          message: String!
          link: String
          
          read: Boolean!
          readAt: AWSDateTime
          
          createdAt: AWSDateTime!
          expiresAt: AWSDateTime
        }

        type AuditLog {
          logId: ID!
          userId: ID!
          orgId: ID
          
          action: AuditAction!
          entityType: String!
          entityId: ID!
          
          previousValue: AWSJSON
          newValue: AWSJSON
          
          ipAddress: String
          userAgent: String
          
          timestamp: AWSDateTime!
        }

        # ============================================
        # METRICS & ANALYTICS TYPES
        # ============================================

        type PlatformMetrics {
          totalCapitalDeployed: Float!
          totalInvestors: Int!
          totalBanks: Int!
          totalActiveLoans: Int!
          totalLoanVolume: Float!
          avgPlatformYield: Float!
          monthlyRevenue: Float!
          monthlyGrowth: Float!
          
          capitalByMonth: [MonthlyDataPoint]
          revenueByMonth: [MonthlyDataPoint]
          
          lastUpdated: AWSDateTime!
        }

        type BankMetrics {
          orgId: ID!
          totalCapital: Float!
          activeLoans: Int!
          loanVolume: Float!
          monthlyYield: Float!
          nplRate: Float!
          avgLoanSize: Float!
          disbursementsToday: Int!
          collectionsToday: Int!
          
          loanStatusDistribution: [StatusDistribution]
          weeklyDisbursements: [DailyDataPoint]
          
          lastUpdated: AWSDateTime!
        }

        type InvestorMetrics {
          orgId: ID!
          totalInvested: Float!
          activeInstruments: Int!
          avgYield: Float!
          portfolioGrowth: Float!
          pendingMaturity: Int!
          
          portfolioByBank: [BankAllocation]
          yieldHistory: [MonthlyDataPoint]
          
          lastUpdated: AWSDateTime!
        }

        type MonthlyDataPoint {
          month: String!
          value: Float!
        }

        type DailyDataPoint {
          day: String!
          amount: Float!
        }

        type StatusDistribution {
          status: String!
          count: Int!
          pct: Float!
        }

        type BankAllocation {
          bank: String!
          bankId: ID!
          amount: Float!
        }

        # ============================================
        # INPUT TYPES
        # ============================================

        input CreateOrganizationInput {
          orgType: OrganizationType!
          name: String!
          email: String!
          country: String!
          institutionType: String
          moodysRating: String
          website: String
          address: String
          phone: String
          swiftCode: String
          centralBankLicense: String
          aum: Float
          investmentFocus: [String]
        }

        input UpdateOrganizationInput {
          orgId: ID!
          name: String
          email: String
          institutionType: String
          moodysRating: String
          website: String
          address: String
          phone: String
          swiftCode: String
          centralBankLicense: String
          aum: Float
          investmentFocus: [String]
        }

        input CreateUserInput {
          email: String!
          name: String!
          role: UserRole!
          orgId: ID
          jobRole: String
          phone: String
        }

        input UpdateUserInput {
          userId: ID!
          name: String
          role: UserRole
          jobRole: String
          phone: String
        }

        input CreateCapitalCallInput {
          bankOrgId: ID!
          amount: Float!
          currency: String!
          targetCurrency: String!
          maturityMonths: Int!
          interestRate: Float!
          fxSpread: Float
          hedgingFee: Float
          currentFxRate: Float
          intendedUse: String
          notes: String
        }

        input UpdateCapitalCallInput {
          callId: ID!
          amount: Float
          maturityMonths: Int
          interestRate: Float
          fxSpread: Float
          hedgingFee: Float
          currentFxRate: Float
          intendedUse: String
          notes: String
        }

        input CreateInvestmentInput {
          callId: ID!
          investorOrgId: ID!
          amount: Float!
        }

        input SubmitKycInput {
          investmentId: ID!
          kycDocuments: AWSJSON!
          bankDetails: AWSJSON!
        }

        input CreateMobileLoanInput {
          bankOrgId: ID!
          borrowerPhone: String!
          borrowerName: String
          borrowerIdNumber: String
          amount: Float!
          currency: String!
          interestRate: Float!
          term: Int!
          creditScore: Int
        }

        input RecordPaymentInput {
          loanId: ID!
          amount: Float!
          mpesaRef: String
          mpesaPhone: String
        }

        input PaginationInput {
          limit: Int
          nextToken: String
        }

        input DateRangeInput {
          startDate: AWSDateTime!
          endDate: AWSDateTime!
        }

        # ============================================
        # RESPONSE TYPES
        # ============================================

        type OrganizationConnection {
          items: [Organization]!
          nextToken: String
          totalCount: Int
        }

        type UserConnection {
          items: [User]!
          nextToken: String
          totalCount: Int
        }

        type CapitalCallConnection {
          items: [CapitalCall]!
          nextToken: String
          totalCount: Int
        }

        type InvestmentConnection {
          items: [Investment]!
          nextToken: String
          totalCount: Int
        }

        type MobileLoanConnection {
          items: [MobileLoan]!
          nextToken: String
          totalCount: Int
        }

        type NotificationConnection {
          items: [Notification]!
          nextToken: String
          unreadCount: Int
        }

        type AuditLogConnection {
          items: [AuditLog]!
          nextToken: String
          totalCount: Int
        }

        # ============================================
        # QUERIES
        # ============================================

        type Query {
          # Organizations
          getOrganization(orgId: ID!): Organization
          listOrganizations(filter: OrganizationType, pagination: PaginationInput): OrganizationConnection!
          listBanks(pagination: PaginationInput): OrganizationConnection!
          listInvestors(pagination: PaginationInput): OrganizationConnection!
          
          # Users
          getUser(userId: ID!): User
          getUserByEmail(email: String!): User
          listUsers(pagination: PaginationInput): UserConnection!
          listUsersByOrganization(orgId: ID!, pagination: PaginationInput): UserConnection!
          
          # Capital Calls
          getCapitalCall(callId: ID!): CapitalCall
          getCapitalCallByTxnRef(txnRef: String!): CapitalCall
          listCapitalCalls(pagination: PaginationInput): CapitalCallConnection!
          listCapitalCallsByBank(bankOrgId: ID!, pagination: PaginationInput): CapitalCallConnection!
          listPublishedCalls(pagination: PaginationInput): CapitalCallConnection!
          
          # Investments
          getInvestment(investmentId: ID!): Investment
          listInvestments(pagination: PaginationInput): InvestmentConnection!
          listInvestmentsByInvestor(investorOrgId: ID!, pagination: PaginationInput): InvestmentConnection!
          listInvestmentsByCapitalCall(callId: ID!, pagination: PaginationInput): InvestmentConnection!
          
          # Mobile Loans
          getMobileLoan(loanId: ID!): MobileLoan
          listMobileLoansByBank(bankOrgId: ID!, status: MobileLoanStatus, pagination: PaginationInput): MobileLoanConnection!
          listMobileLoansByBorrower(borrowerPhone: String!, pagination: PaginationInput): MobileLoanConnection!
          
          # Metrics & Analytics
          getPlatformMetrics: PlatformMetrics!
          getBankMetrics(orgId: ID!): BankMetrics!
          getInvestorMetrics(orgId: ID!): InvestorMetrics!
          
          # Notifications
          listNotifications(userId: ID!, unreadOnly: Boolean, pagination: PaginationInput): NotificationConnection!
          
          # Audit Logs
          listAuditLogs(orgId: ID, userId: ID, action: AuditAction, dateRange: DateRangeInput, pagination: PaginationInput): AuditLogConnection!
        }

        # ============================================
        # MUTATIONS
        # ============================================

        type Mutation {
          # Organizations (ForwardsFlow Admin only)
          createOrganization(input: CreateOrganizationInput!): Organization!
          updateOrganization(input: UpdateOrganizationInput!): Organization!
          suspendOrganization(orgId: ID!, reason: String): Organization!
          activateOrganization(orgId: ID!): Organization!
          
          # Users (Admins only)
          createUser(input: CreateUserInput!): User!
          updateUser(input: UpdateUserInput!): User!
          suspendUser(userId: ID!, reason: String): User!
          activateUser(userId: ID!): User!
          
          # Capital Calls (Bank roles)
          createCapitalCall(input: CreateCapitalCallInput!): CapitalCall!
          updateCapitalCall(input: UpdateCapitalCallInput!): CapitalCall!
          publishCapitalCall(callId: ID!): CapitalCall!
          cancelCapitalCall(callId: ID!, reason: String): CapitalCall!
          
          # Investments (Investor roles)
          createInvestment(input: CreateInvestmentInput!): Investment!
          updateInvestment(investmentId: ID!, amount: Float): Investment!
          submitKyc(input: SubmitKycInput!): Investment!
          cancelInvestment(investmentId: ID!, reason: String): Investment!
          
          # Investment Approval (Bank compliance/admin)
          approveKyc(investmentId: ID!): Investment!
          rejectKyc(investmentId: ID!, reason: String!): Investment!
          
          # Investment Completion (System/Admin)
          approveInvestment(investmentId: ID!): Investment!
          completeInvestment(investmentId: ID!): Investment!
          
          # Mobile Loans (Bank lender roles)
          createMobileLoan(input: CreateMobileLoanInput!): MobileLoan!
          approveMobileLoan(loanId: ID!): MobileLoan!
          rejectMobileLoan(loanId: ID!, reason: String!): MobileLoan!
          disburseMobileLoan(loanId: ID!): MobileLoan!
          recordLoanPayment(input: RecordPaymentInput!): MobileLoan!
          writeOffLoan(loanId: ID!, reason: String!): MobileLoan!
          
          # Notifications
          markNotificationRead(notificationId: ID!): Notification!
          markAllNotificationsRead(userId: ID!): Boolean!
          
          # Admin Actions
          refreshPlatformMetrics: PlatformMetrics!
          refreshBankMetrics(orgId: ID!): BankMetrics!
          seedDemoData: Boolean!
        }

        # ============================================
        # SUBSCRIPTIONS (Real-time)
        # ============================================

        type Subscription {
          # Capital Call subscriptions
          onCapitalCallCreated: CapitalCall
            @aws_subscribe(mutations: ["createCapitalCall", "publishCapitalCall"])
          
          onCapitalCallUpdated(callId: ID, bankOrgId: ID): CapitalCall
            @aws_subscribe(mutations: ["updateCapitalCall", "cancelCapitalCall"])
          
          # Investment subscriptions (for banks to see incoming investments)
          onInvestmentCreated(bankOrgId: ID): Investment
            @aws_subscribe(mutations: ["createInvestment"])
          
          onInvestmentUpdated(investmentId: ID, investorOrgId: ID, bankOrgId: ID): Investment
            @aws_subscribe(mutations: ["updateInvestment", "submitKyc", "approveKyc", "rejectKyc", "approveInvestment", "completeInvestment"])
          
          # Notification subscriptions
          onNotificationCreated(userId: ID!, orgId: ID): Notification
            @aws_subscribe(mutations: ["createNotification"])
          
          # Mobile Loan subscriptions (for bank dashboards)
          onMobileLoanUpdated(bankOrgId: ID!): MobileLoan
            @aws_subscribe(mutations: ["createMobileLoan", "approveMobileLoan", "disburseMobileLoan", "recordLoanPayment"])
        }

        # ============================================
        # SCHEMA
        # ============================================

        schema {
          query: Query
          mutation: Mutation
          subscription: Subscription
        }
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/Schema
  ForwardsFlowApiDefaultApiKey3F4572A5:
    Type: AWS::AppSync::ApiKey
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      Description: API Key for public endpoints
      Expires: 1796817829
    DependsOn:
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/DefaultApiKey
  ForwardsFlowApiLogRetention74946E73:
    Type: Custom::LogRetention
    Properties:
      ServiceToken:
        Fn::GetAtt:
          - LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A
          - Arn
      LogGroupName:
        Fn::Join:
          - ""
          - - /aws/appsync/apis/
            - Fn::GetAtt:
                - ForwardsFlowApi1E228389
                - ApiId
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/LogRetention/Resource
  ForwardsFlowApiLambdaDataSourceServiceRole3F262333:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: appsync.amazonaws.com
        Version: "2012-10-17"
      Tags:
        - Key: Environment
          Value: development
        - Key: Project
          Value: ForwardsFlow
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/LambdaDataSource/ServiceRole/Resource
  ForwardsFlowApiLambdaDataSourceServiceRoleDefaultPolicyCC03140B:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action: lambda:InvokeFunction
            Effect: Allow
            Resource:
              - Fn::GetAtt:
                  - ResolverLambdaEC7302D3
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - ResolverLambdaEC7302D3
                        - Arn
                    - :*
        Version: "2012-10-17"
      PolicyName: ForwardsFlowApiLambdaDataSourceServiceRoleDefaultPolicyCC03140B
      Roles:
        - Ref: ForwardsFlowApiLambdaDataSourceServiceRole3F262333
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/LambdaDataSource/ServiceRole/DefaultPolicy/Resource
  ForwardsFlowApiLambdaDataSource80267E49:
    Type: AWS::AppSync::DataSource
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      LambdaConfig:
        LambdaFunctionArn:
          Fn::GetAtt:
            - ResolverLambdaEC7302D3
            - Arn
      Name: LambdaDataSource
      ServiceRoleArn:
        Fn::GetAtt:
          - ForwardsFlowApiLambdaDataSourceServiceRole3F262333
          - Arn
      Type: AWS_LAMBDA
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/LambdaDataSource/Resource
  ForwardsFlowApiGetOrganizationResolver458A2068:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: getOrganization
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/GetOrganizationResolver/Resource
  ForwardsFlowApiListOrganizationsResolverB8CC85E8:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listOrganizations
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListOrganizationsResolver/Resource
  ForwardsFlowApiListBanksResolver10FA8FD6:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listBanks
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListBanksResolver/Resource
  ForwardsFlowApiListInvestorsResolverB2957AC1:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listInvestors
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListInvestorsResolver/Resource
  ForwardsFlowApiGetUserResolver3E00BCDB:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: getUser
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/GetUserResolver/Resource
  ForwardsFlowApiListUsersResolver0A2C137E:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listUsers
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListUsersResolver/Resource
  ForwardsFlowApiListUsersByOrgResolver7C73BF1B:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listUsersByOrganization
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListUsersByOrgResolver/Resource
  ForwardsFlowApiGetCapitalCallResolver4459B775:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: getCapitalCall
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/GetCapitalCallResolver/Resource
  ForwardsFlowApiListCapitalCallsResolver56298D57:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listCapitalCalls
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListCapitalCallsResolver/Resource
  ForwardsFlowApiListCapitalCallsByBankResolver0C6C9D98:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listCapitalCallsByBank
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListCapitalCallsByBankResolver/Resource
  ForwardsFlowApiListPublishedCallsResolver10C18140:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listPublishedCalls
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListPublishedCallsResolver/Resource
  ForwardsFlowApiGetInvestmentResolver2C4A78BB:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: getInvestment
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/GetInvestmentResolver/Resource
  ForwardsFlowApiListInvestmentsResolver11ED2471:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listInvestments
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListInvestmentsResolver/Resource
  ForwardsFlowApiListInvestmentsByInvestorResolver6AF20046:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listInvestmentsByInvestor
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListInvestmentsByInvestorResolver/Resource
  ForwardsFlowApiGetMobileLoanResolverC25E27B8:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: getMobileLoan
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/GetMobileLoanResolver/Resource
  ForwardsFlowApiListMobileLoansByBankResolverFABBDFA4:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listMobileLoansByBank
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListMobileLoansByBankResolver/Resource
  ForwardsFlowApiGetPlatformMetricsResolverF9504AC1:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: getPlatformMetrics
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/GetPlatformMetricsResolver/Resource
  ForwardsFlowApiGetBankMetricsResolver506CF634:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: getBankMetrics
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/GetBankMetricsResolver/Resource
  ForwardsFlowApiGetInvestorMetricsResolver345333E3:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: getInvestorMetrics
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/GetInvestorMetricsResolver/Resource
  ForwardsFlowApiListNotificationsResolver5B6BF69B:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listNotifications
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListNotificationsResolver/Resource
  ForwardsFlowApiListAuditLogsResolverE20CF574:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: listAuditLogs
      Kind: UNIT
      TypeName: Query
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ListAuditLogsResolver/Resource
  ForwardsFlowApiCreateOrganizationResolver866D0496:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: createOrganization
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/CreateOrganizationResolver/Resource
  ForwardsFlowApiUpdateOrganizationResolver87811E44:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: updateOrganization
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/UpdateOrganizationResolver/Resource
  ForwardsFlowApiSuspendOrganizationResolver0BB63610:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: suspendOrganization
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/SuspendOrganizationResolver/Resource
  ForwardsFlowApiCreateUserResolver79F8213A:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: createUser
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/CreateUserResolver/Resource
  ForwardsFlowApiUpdateUserResolverEA12C102:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: updateUser
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/UpdateUserResolver/Resource
  ForwardsFlowApiSuspendUserResolverEE55E2E1:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: suspendUser
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/SuspendUserResolver/Resource
  ForwardsFlowApiCreateCapitalCallResolver41C61C50:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: createCapitalCall
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/CreateCapitalCallResolver/Resource
  ForwardsFlowApiUpdateCapitalCallResolverE88E82B8:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: updateCapitalCall
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/UpdateCapitalCallResolver/Resource
  ForwardsFlowApiPublishCapitalCallResolver3DDFD74F:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: publishCapitalCall
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/PublishCapitalCallResolver/Resource
  ForwardsFlowApiCancelCapitalCallResolver05A573D1:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: cancelCapitalCall
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/CancelCapitalCallResolver/Resource
  ForwardsFlowApiCreateInvestmentResolverD84B7F38:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: createInvestment
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/CreateInvestmentResolver/Resource
  ForwardsFlowApiUpdateInvestmentResolver855FB207:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: updateInvestment
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/UpdateInvestmentResolver/Resource
  ForwardsFlowApiSubmitKycResolver196CDE9A:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: submitKyc
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/SubmitKycResolver/Resource
  ForwardsFlowApiApproveInvestmentResolverDAFC4777:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: approveInvestment
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ApproveInvestmentResolver/Resource
  ForwardsFlowApiCompleteInvestmentResolver8E748E41:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: completeInvestment
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/CompleteInvestmentResolver/Resource
  ForwardsFlowApiCreateMobileLoanResolver6131640D:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: createMobileLoan
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/CreateMobileLoanResolver/Resource
  ForwardsFlowApiApproveMobileLoanResolverBECE9A2C:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: approveMobileLoan
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/ApproveMobileLoanResolver/Resource
  ForwardsFlowApiDisburseMobileLoanResolver7E109228:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: disburseMobileLoan
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/DisburseMobileLoanResolver/Resource
  ForwardsFlowApiRecordLoanPaymentResolver521AE421:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: recordLoanPayment
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/RecordLoanPaymentResolver/Resource
  ForwardsFlowApiMarkNotificationReadResolver6637174E:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: markNotificationRead
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/MarkNotificationReadResolver/Resource
  ForwardsFlowApiMarkAllNotificationsReadResolver75FB9541:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: LambdaDataSource
      FieldName: markAllNotificationsRead
      Kind: UNIT
      TypeName: Mutation
    DependsOn:
      - ForwardsFlowApiLambdaDataSource80267E49
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/MarkAllNotificationsReadResolver/Resource
  ForwardsFlowApiNoneDataSourceA4832E0E:
    Type: AWS::AppSync::DataSource
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      Name: NoneDataSource
      Type: NONE
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/NoneDataSource/Resource
  ForwardsFlowApiOnCapitalCallCreatedResolver5E95FEE8:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: NoneDataSource
      FieldName: onCapitalCallCreated
      Kind: UNIT
      RequestMappingTemplate: |-
        {
                "version": "2017-02-28",
                "payload": $util.toJson($context.arguments)
              }
      ResponseMappingTemplate: $util.toJson($context.result)
      TypeName: Subscription
    DependsOn:
      - ForwardsFlowApiNoneDataSourceA4832E0E
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/OnCapitalCallCreatedResolver/Resource
  ForwardsFlowApiOnCapitalCallUpdatedResolver347C2075:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: NoneDataSource
      FieldName: onCapitalCallUpdated
      Kind: UNIT
      RequestMappingTemplate: |-
        {
                "version": "2017-02-28",
                "payload": $util.toJson($context.arguments)
              }
      ResponseMappingTemplate: $util.toJson($context.result)
      TypeName: Subscription
    DependsOn:
      - ForwardsFlowApiNoneDataSourceA4832E0E
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/OnCapitalCallUpdatedResolver/Resource
  ForwardsFlowApiOnInvestmentCreatedResolverFB9A5B44:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: NoneDataSource
      FieldName: onInvestmentCreated
      Kind: UNIT
      RequestMappingTemplate: |-
        {
                "version": "2017-02-28",
                "payload": $util.toJson($context.arguments)
              }
      ResponseMappingTemplate: $util.toJson($context.result)
      TypeName: Subscription
    DependsOn:
      - ForwardsFlowApiNoneDataSourceA4832E0E
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/OnInvestmentCreatedResolver/Resource
  ForwardsFlowApiOnInvestmentUpdatedResolver33DFB237:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: NoneDataSource
      FieldName: onInvestmentUpdated
      Kind: UNIT
      RequestMappingTemplate: |-
        {
                "version": "2017-02-28",
                "payload": $util.toJson($context.arguments)
              }
      ResponseMappingTemplate: $util.toJson($context.result)
      TypeName: Subscription
    DependsOn:
      - ForwardsFlowApiNoneDataSourceA4832E0E
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/OnInvestmentUpdatedResolver/Resource
  ForwardsFlowApiOnNotificationCreatedResolverE70E0993:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: NoneDataSource
      FieldName: onNotificationCreated
      Kind: UNIT
      RequestMappingTemplate: |-
        {
                "version": "2017-02-28",
                "payload": $util.toJson($context.arguments)
              }
      ResponseMappingTemplate: $util.toJson($context.result)
      TypeName: Subscription
    DependsOn:
      - ForwardsFlowApiNoneDataSourceA4832E0E
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/OnNotificationCreatedResolver/Resource
  ForwardsFlowApiOnMobileLoanUpdatedResolver132ECA50:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Fn::GetAtt:
          - ForwardsFlowApi1E228389
          - ApiId
      DataSourceName: NoneDataSource
      FieldName: onMobileLoanUpdated
      Kind: UNIT
      RequestMappingTemplate: |-
        {
                "version": "2017-02-28",
                "payload": $util.toJson($context.arguments)
              }
      ResponseMappingTemplate: $util.toJson($context.result)
      TypeName: Subscription
    DependsOn:
      - ForwardsFlowApiNoneDataSourceA4832E0E
      - ForwardsFlowApiSchemaBCD6DAB4
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ForwardsFlowApi/OnMobileLoanUpdatedResolver/Resource
  LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Tags:
        - Key: Environment
          Value: development
        - Key: Project
          Value: ForwardsFlow
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/Resource
  LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:DeleteRetentionPolicy
              - logs:PutRetentionPolicy
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB
      Roles:
        - Ref: LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy/Resource
  LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A:
    Type: AWS::Lambda::Function
    Properties:
      Handler: index.handler
      Runtime: nodejs22.x
      Timeout: 900
      Code:
        S3Bucket: cdk-hnb659fds-assets-503561437485-eu-west-1
        S3Key: 2819175352ad1ce0dae768e83fc328fb70fb5f10b4a8ff0ccbcb791f02b0716d.zip
      Role:
        Fn::GetAtt:
          - LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB
          - Arn
      Tags:
        - Key: Environment
          Value: development
        - Key: Project
          Value: ForwardsFlow
    DependsOn:
      - LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB
      - LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Resource
      aws:asset:path: asset.2819175352ad1ce0dae768e83fc328fb70fb5f10b4a8ff0ccbcb791f02b0716d
      aws:asset:is-bundled: false
      aws:asset:property: Code
  ResolverLambdaServiceRoleDF11267D:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      Tags:
        - Key: Environment
          Value: development
        - Key: Project
          Value: ForwardsFlow
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ResolverLambda/ServiceRole/Resource
  ResolverLambdaServiceRoleDefaultPolicyA9E6A3D6:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - dynamodb:BatchGetItem
              - dynamodb:BatchWriteItem
              - dynamodb:ConditionCheckItem
              - dynamodb:DeleteItem
              - dynamodb:DescribeTable
              - dynamodb:GetItem
              - dynamodb:GetRecords
              - dynamodb:GetShardIterator
              - dynamodb:PutItem
              - dynamodb:Query
              - dynamodb:Scan
              - dynamodb:UpdateItem
            Effect: Allow
            Resource:
              - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttAuditLogsTable7D096F6FArnA930D5BA
              - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttCapitalCallsTable208B96A9Arn413E4F7D
              - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttInvestmentsTable66692819Arn5FB7CD25
              - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttMetricsTable2972A477ArnE69DC4C0
              - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttMobileLoansTable246C206CArnDAF1554B
              - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttNotificationsTable76DCFC6CArn012EC0C4
              - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttOrganizationsTable01047E98ArnEB6BFC2E
              - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttPaymentsTable48A42630Arn6636311E
              - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttUsersTable9725E9C8Arn5684EF99
              - Fn::Join:
                  - ""
                  - - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttAuditLogsTable7D096F6FArnA930D5BA
                    - /index/*
              - Fn::Join:
                  - ""
                  - - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttCapitalCallsTable208B96A9Arn413E4F7D
                    - /index/*
              - Fn::Join:
                  - ""
                  - - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttInvestmentsTable66692819Arn5FB7CD25
                    - /index/*
              - Fn::Join:
                  - ""
                  - - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttMetricsTable2972A477ArnE69DC4C0
                    - /index/*
              - Fn::Join:
                  - ""
                  - - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttMobileLoansTable246C206CArnDAF1554B
                    - /index/*
              - Fn::Join:
                  - ""
                  - - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttNotificationsTable76DCFC6CArn012EC0C4
                    - /index/*
              - Fn::Join:
                  - ""
                  - - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttOrganizationsTable01047E98ArnEB6BFC2E
                    - /index/*
              - Fn::Join:
                  - ""
                  - - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttPaymentsTable48A42630Arn6636311E
                    - /index/*
              - Fn::Join:
                  - ""
                  - - Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputFnGetAttUsersTable9725E9C8Arn5684EF99
                    - /index/*
        Version: "2012-10-17"
      PolicyName: ResolverLambdaServiceRoleDefaultPolicyA9E6A3D6
      Roles:
        - Ref: ResolverLambdaServiceRoleDF11267D
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ResolverLambda/ServiceRole/DefaultPolicy/Resource
  ResolverLambdaEC7302D3:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket: cdk-hnb659fds-assets-503561437485-eu-west-1
        S3Key: fba4e43107fad04a26b64a5d51b5f9493a49fb4e1382673c91547993bb9f107c.zip
      Environment:
        Variables:
          ORGANIZATIONS_TABLE:
            Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputRefOrganizationsTable01047E982050E92F
          USERS_TABLE:
            Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputRefUsersTable9725E9C857961836
          CAPITAL_CALLS_TABLE:
            Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputRefCapitalCallsTable208B96A9B892974B
          INVESTMENTS_TABLE:
            Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputRefInvestmentsTable66692819D7322F7D
          MOBILE_LOANS_TABLE:
            Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputRefMobileLoansTable246C206C453DCEEA
          PAYMENTS_TABLE:
            Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputRefPaymentsTable48A42630E9179FB6
          METRICS_TABLE:
            Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputRefMetricsTable2972A4778D6F7F67
          AUDIT_LOGS_TABLE:
            Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputRefAuditLogsTable7D096F6FD00CC541
          NOTIFICATIONS_TABLE:
            Fn::ImportValue: ForwardsFlowDatabaseStack:ExportsOutputRefNotificationsTable76DCFC6C32DE73EE
      FunctionName: ForwardsFlow-GraphQL-Resolver
      Handler: index.handler
      MemorySize: 512
      Role:
        Fn::GetAtt:
          - ResolverLambdaServiceRoleDF11267D
          - Arn
      Runtime: nodejs18.x
      Tags:
        - Key: Environment
          Value: development
        - Key: Project
          Value: ForwardsFlow
      Timeout: 30
    DependsOn:
      - ResolverLambdaServiceRoleDefaultPolicyA9E6A3D6
      - ResolverLambdaServiceRoleDF11267D
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/ResolverLambda/Resource
      aws:asset:path: asset.fba4e43107fad04a26b64a5d51b5f9493a49fb4e1382673c91547993bb9f107c
      aws:asset:is-bundled: false
      aws:asset:property: Code
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Analytics: v2:deflate64:H4sIAAAAAAAA/1WOwW7CMBBEv4W7s1WS/gBQtYdGLU3UM1rMEkwcb5p1QCjKv1c2IqWnebMztiaDLM8gXeBFEr1vEmt2MFYedaPwIttRc+2MZxi/hfoNs1Xrg5v5DmtryPnH6HaZFHadXJ2G8a3H7vhjl50Jtei+iv+u0kdqMRyWnXmnqyqw3e3xBT1WPPSaQvTgShK2Z+rDeeYPdvTXmZTBFsaSbXwcdcPW6GuwN5qU5Vqg4LokT84bdkryLYqQF1gGUZLDatAN+RUKKRt3wfg6OB3r64O78zTFXfe5M8d/Ko+1cXUIPgffDX5SjvcEJ3k6Z8+QppAuTmJM0g/Om5agvOkvEZZ40aYBAAA=
    Metadata:
      aws:cdk:path: ForwardsFlowApiStack/CDKMetadata/Default
Outputs:
  GraphQLApiUrl:
    Value:
      Fn::GetAtt:
        - ForwardsFlowApi1E228389
        - GraphQLUrl
    Export:
      Name: ForwardsFlow-GraphQLUrl
  GraphQLApiId:
    Value:
      Fn::GetAtt:
        - ForwardsFlowApi1E228389
        - ApiId
    Export:
      Name: ForwardsFlow-GraphQLApiId
  UserPoolId:
    Value:
      Ref: ForwardsFlowUserPoolDE2BB0ED
    Export:
      Name: ForwardsFlow-UserPoolId
  UserPoolClientId:
    Value:
      Ref: ForwardsFlowUserPoolForwardsFlowWebClient8B6306A6
    Export:
      Name: ForwardsFlow-UserPoolClientId
Parameters:
  BootstrapVersion:
    Type: AWS::SSM::Parameter::Value<String>
    Default: /cdk-bootstrap/hnb659fds/version
    Description: Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]

